=begin
Makes text a bit glitchy.
Type "\X[chance]" to activate or "\X[0] to deactivate the effect.
=end

GLITCH_TIMER_MAX = 5
#CHARACTERS = "人一丨口日目儿見凵山出十八木未丶来大亅了子心土冂田思二丁彳行寸寺時卜上丿刀分厶禾私中彐尹事可亻何自乂又皮彼亠方生月門間扌手言女本乙气気干年三耂者刂前勹勿豕冖宀家今下白勺的云牛物立小文矢知入乍作聿書学合幺夂後持古尸居灬無水羊様音意也地止午卩卸御至屋廾廿厂广度同不実千舌話身戸斤所先力五明弋代犬然用廴辶通耳聞衣艮長少己竹弓第戈感世工穴空囗四王里理主久夕名面場彡彦貝頁顔君万成考首道正阝郎当男外玉国会取新虫几風申礻神重動部向夜内青相体眼味業僕多士声現平葉全足七切金近巴色癶発母高以匕歹死旦得豆頭欠冫次天夫具真甘其父親巾帰対美六引予野笑表等忄情歩馬形太川各氵洛落性食此有仕冊論最記信衤初問亦変直達去法活込村吾語孝攵教着社別兀光好亜悪和右若化花氏底吉糸結処原兄説車走起字流占点他想交校我義爪愛百罒置叩命韋違如早朝反返関米数石海吊常付九角解東火之西要苦過定町安庫且助頃巳民半隹集誰共供升飛在丘兵開草強紙深待幾機夬決遠是題楽利張示余比皆必歌打呼根覚老京由品台治周調姿売読丙疒病種連甲単戦始念室公急島左黒突介界術坐座受丹舟船元観吏使経図進残画松凡恐赤殳殺式釆番呈程師存伝軍運果良娘識奇寄両或黄横議友非婦寝酉酒失武判支加細質特祭際路政告列例客貴雨雪能位暗芸辰振片難井乗茶故準宮店冬終息電丸勢衛匚匸亡望春旨指配役幸階景影渡於夢巻凶胸制極臣蔵奥都圭掛段態江悲限肖消絶追勝離精与守氺藤類妻素官飠館史那谷容甫敷答住折宿遊計召昭注造放壬廷庭為波断働格北背旅続広泉線斗科句敬驚忘炎談産降志鳥鳴越争静押市舛舞奄俺奴泣則側象像洋号浮束頼房送詩参異買従南清系係諸熱服似河怪秋晩将林件城皿血徳腹組満妙昔料円独雲尺沢雑許窓往兆逃喜肉暮博吹更困派曲傍縁喬橋臼興附並期毋毎抜岸求労薄黙而端虍劇確末弟絵裏改令冷乃及訳飲呆保途完院辺殿包抱状評玄刻散卯仰疋疑痛破再構案差族緒銀軽版堂福刃忍認恋建衆毛察腰快煙敵負探究岩歳隠伊伸応団歴員候微筆礼源昨羽宗尾眺転商州投願研永留雄憂優佐器証回鹿仏髪致叫演退眠弱固個枝罪央験夏職視報即節富骨善斉済写育約密弁床戻涙給唯仲貰焼宛腕陽到倒響坂権苗描勧乱警養岡姉価鼻条寒坊隊龍籠囲星兼嫌登接旧児街任祖刷飯医板毒照局肩盛森辛壁昏婚矛務露丈鉄易郷僧駄狂織境英布帯習因踏湯移倉低責積婆仮津訪鬼麻魔儀魚怒映枚斯修印荒晴筈軒樹尊屮屯純休府怖香允充統園述尢沈紅著普払群欲隻護銭皇呉秘酔捨害割柄厄危匹甚便騒聴短席哲承遣資灯徒舎章鏡就値農傷阿朱殊勇温妹般筋領激這樣曽増迷技頂昼備霊否薬彑互隣選跡傾壮装試速挙層芝詰量復随俗奉浅提浪貧杯批紀吸幕借旡既総輪迎屈脱尋忠滅荷遺箱宅叔柳魂埋依帝捕級秀池植陰刺伏撃懸触伯懐隅暴胃謂珍区洗梅智迫健惑基翌才称膝豊崎剣敢厳納展恥棒額伴逆閉射憶瞬威哀堪殆寂被斎趣却脚講握姓疲染斬暫犯辞砂牙邪油闇概遂聖汽順憎益泊陣慮弾勤推卓誌仙陸頬拠嬢省障虚戯尽併惜畳姫検党製誤呂執華袋減輩浜創莫墓救模燃刑型杉咲昆混麗亭侍査震曜尚鶴敗乞迄功宜費延除栄踊繰貫慣看賀険猫適尼泥録歯漢飾机椅冒帽載俳設帳浴吐瀬慢宝竜扉拝簡菊愚律革編勘規司釈弥童袖揚于宇換材悟努廊維羅盗覧輝球添闘烈畑詞蘭嬉収乳柱摩覗釣導濃算含襲旗熊嫁策圧寧専財揺鮮防偶庵築誘希垂阪停孫鉢潮操免隶康唐針乏略枕蛇裕紫序獄練抵遅避癖幼澄駆只扱緑敏繁隆巧誠狭遇蒼厚綱鋭透噂替潜封愉牧巛巡票標嘘裁壇靴授典幽唇茂届戒械奪拾属挨汚拶帆抗奈卒監鈴討亘垣膳駒卑眉閣営粉拭範猿暑恵祈謝浦較乾奮管汗祝札匠勉胡湖貨臭悩偉砲尻氷嘆貞孔濁駅堅昌唱塔馴曹率涯庄灰棄貸叱枯徴招暇邸柔宣俊賞霧週禁豪朋棚塩漸郡躍整紋塗恩稽縦翁匂効凝崩縮掘衝唄桜麦蒲斥訴損裂滑沙淡徹喧幻堀誇悔藩笛享熟締暖葬稿偵瓜孤兔逸骸爵雀課県尉慰巨仁憤攻超忙裸須鼓孟猛荘恨惨寛溜僅稲凄雇顧肥閑腐倍季艦岳采菜寿焦拘笠脳協壊沼慈拙宙煮肌符賢据斜揃拡請鶏賊彩虎需濡悦酷窮紹獣爆測督抑競絹蓋継胆採曇掌蓮桃鐘審彫瓦捜隔隙炭醜湧猶偽巣災衰複双陥巷港劣歓廃洲臨漁奏補睡揮侯塚網某磨雷缶鬱環綿紳豸貌嘩襟縫涼催盤銃拍戴裾菓顕担飽鎌辻臓粗訓委謀惚遍粋崖硝盾詳誉炉没潔峰芳洞掃昇稀縛喉税刊珠冠滝預幅企銅縄瓶陳脈呪覆窟宵抽署献脇墨紛渉緊筒栗畜翼煩沿控泰盲蔑征域餅漂施烏亀串患伺賃艶喋冗忌箇傘扇還蹴翻李索琴跳飼辱艇痩浄芽騎峠欧罰魅醒促頓沖幹履圏蒸慶妖鍵汁盆霜距譲渋鑑泳齢穂怨括屏塀獲磯絡汰痴剥賛蜂柴頻耒籍蘇倫穏肯贈牲嘲疾誓航盟尖慌漠啓頑膚怠笹鈍摘柿詮契喫咽蚊邦鎖粒萩均胴罵鍋雅憲喚鎮楼肝欄浸噴漫徐挿詣爿淵悠捉股鴨璃猪傑耐宴診朗剛陶卵幣吟狩謙励犠宰遥礎渦潰耕療弄崇囚銘旋豚禅斐瞳粧掲錯晶拳慕架諦潤堤砕刈塞岐弘援殖鷹欺排暦脅痕叙酌慄猟臆瑠滴但梢塊妨顎謡嵐溝繋慎疎貢撲絞嫉凍輸析株秩愁妬郵葛蓄侮液畏隈鉛慨詠僚拒藻稚緩庸錦携弦癒滞穀暁況桂伐擦芋恭庁懇績泡霞堕把瞭撮箸湿賭謎稼偏釜樽奔侵蔽鍛桑狙融脂餌苛逐刹麓径騰薫溶藍羨削酸庶遮哉紺嗅蛮漬糧郊糖粛遭柏棟昧塾硬坪貼朴蜜侶飢貯弧餓択碑渓后妄俵喪虐褒託伎桐殻廉副克戚項梁薪腸棺炊爽禍漏丑肺唾碁湾玩沸陵憾韻擁雰婿賜媒扶鉱坑斑諾践隷淫鯉浩謹赦誕篤佳漱挟杏喝渇髄溺旬錠儒梨膨秒償篠磐赴畔恒胞零貪弊諭脊衡酬遷朽冶諧柵軸朔茅羞函班拓桟洪捻冥濯懲胎摂敦郭譜虹軟措訂憧核披墜殴瑞倣億磁椎症挑鯨剖遜凹雌萎募棋娯寮傲勅妃妥迅茎煎擬峡韓繕寡嚇濫腫叶漆陛罷抄燥剤租簿萌惰購券繊閲奨粘勃累栽岬梗駐貿毀窃賦潟債曖虜穫喩肢搾匿淳肘軌厘膜褐槽祥腎淑販翔勲堆睦抹枠舗剰詐幌汐錬薦閥培憩聡逝勾墳菌鋼挫鋳覇賓滋凸茨苑唆殉阻桁訟菱搬嗣旺妊娠酢旭綻帥舶渚尿賄汎栓硫蛍醸肪疫惧遡緯辣媛窒弐拷嫡礁窯虞逮麺該循壱拐撤矯俸踪紡酎糾枢阜悼姻拉耗痢塁芯栃丼璧捗箋彙泌彰埼嘱畿壌填賂轄逓酵賠准腺搭哺瘍祉"
CHARACTERS = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"

class Window_Base < Window
  alias gt_initialize initialize
  def initialize(x, y, width, height)
    gt_initialize(x, y, width, height)
    @gt_glitch_chance = 10
    @gt_glitch_timer = GLITCH_TIMER_MAX
    @gt_glitched = []
  end
  
  alias gt_update update
  def update
    gt_update
    @gt_glitch_timer -= 1
    if (@gt_glitch_timer == 0)
      @gt_glitch_timer = GLITCH_TIMER_MAX
      gt_draw_glitched
    end
  end
  
  def gt_draw_glitched
    @gt_glitched.each do |entry|
      c = entry[:char]
      cSize = text_size(c)
      cSize.width *= 2
      if (rand(100) < entry[:chance])
        c = CHARACTERS[rand(CHARACTERS.length)]
      end
      contents.clear_rect(entry[:x], entry[:y], cSize.width, cSize.height)
      change_color(entry[:color])
      draw_text(entry[:x], entry[:y], cSize.width, cSize.height, c)
    end
  end
  
  alias gt_process_escape_character process_escape_character
  def process_escape_character(code, text, pos)
    if (code.upcase == "X")
      @gt_glitch_chance = obtain_escape_param(text)
    else
      gt_process_escape_character(code, text, pos)
    end
  end
  
  alias gt_process_normal_character process_normal_character
  def process_normal_character(c, pos)
    if (@gt_glitch_chance != 0)
      data = {
        :char => c,
        :x => pos[:x],
        :y => pos[:y],
        :chance => @gt_glitch_chance,
        :color => Color.new.set(contents.font.color)
      }
      @gt_glitched.push(data)
      pos[:x] += text_size(c).width
    else
      gt_process_normal_character(c, pos)
    end
  end
  
  alias gt_reset_font_settings reset_font_settings
  def reset_font_settings
    gt_reset_font_settings
    @gt_glitch_chance = 0
  end
  
  alias gt_hide hide
  def hide
    gt_clear_glitched
	gt_hide
  end
  
  def gt_clear_glitched
    @gt_glitch_chance = 0
    @gt_glitched = []
  end
end

class Window_Message < Window_Base
  alias gt_new_page new_page
  def new_page(text, pos)
    gt_clear_glitched
    gt_new_page(text, pos)
  end
end

class Window_BattleLog < Window_Selectable
  alias gt_clear clear
  def clear
    gt_clear
    gt_clear_glitched
  end
end

if (Module.const_get("Window_ShrtMsgr").is_a?(Class))
  class Window_ShrtMsgr < Window_Base
    alias gt_reset_font_settings reset_font_settings
    def reset_font_settings
      gt_reset_font_settings
      @gt_glitch_chance = 0
    end
  end
end